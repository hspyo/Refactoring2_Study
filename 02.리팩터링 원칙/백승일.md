# 리펙터링 원칙

## 리펙터링의 정의

리펙터링은 명사와 동사로 사용할 수 있다. 책에서는 다음과 같이 정의 한다.

> > 리팩터링(명사): 소프트웨어의 동작은 유지한 채 코드를 이해하고 수정하기 쉽게 내부 구조를 변경하는 기법
> > 리팩터링(동사): 소프트웨어의 동작은 유지한 채 리팩터링 기법을 이용하여 소프트웨어를 재구성하는 행위

동사인 리팩터링을 보면 '리팩터링 기법' 이라고 언급한다. 즉 특정한 방식에 따라 코드를 정리하는 것만 리팩터링이라고 말한다.

## 리펙터링의 이유

- 소프트웨어의 설계
  리펙터링을 하지 않으면 소프트웨어의 내부 설계(아키텍쳐)가 고이기 쉽다. 아키텍쳐를 제대로 이해 못하고 코드를 수정하다 보면 그 구조가 무너지기 쉽상이다. 그렇게 되면 결국 코드만으로는 설계를 파악하기 어려워진다. 하지만 규칙적인 리펙터링은 코드의 구조를 유지하게 해준다.
  같은 일을 하더라도 설계나 나쁘면 코드가 길어지고 중복되는 코드가 나타날 수 있다. 때문에 중복 코드 제거와 같은 작업이 필요하게 된다. 중복 코드를 줄임으로 코드가 고유한 일을 하고 있음을 보장할 수 있게된다.

- 소프트웨어의 이해
  코드를 작성할 때, 프로그램의 동작에만 집중하다 보면 이후 그 코드를 볼 다른 개발자들을 배려하지 못하는 상황이 온다. 코드를 이해하면 금방 해결할 문제는 며칠을 걸려 해결해야하는 상황이 오기도 하는데, 보통 이후 그 코드를 볼 사람은 본인이 되기 쉽상이다. 때문에 코드는 그 목적이 잘 들어나게 리팩토링을 해야 다시 이 코드를 보게 되더라도 전체적인 흐름을 기억하고 보는게 아니라 수정하는 부분만 보더라도 쉽게 이해할 수 있게된다. 코드의 이해가 쉬워지니 에러가 발생해도 버그를 잡는데 수월해 진다.

- 프로그래밍 속도
  리팩터링에 대한 장점을 정리하면 곧 코드 개발 속도를 높일 수 있다는 점 이다. 하지만 개발 중간 중간 리펙터링을 진행함이 개발 속도를 늦추는게 아닐까 생각 할 수 있다. 하지만 구조가 망가지는 코드는 초기 개발이 빠를지 몰라도 이후 기능 추가나 수정 작업이 힘들어진다. 하지만 리펙터링을 진행하면서 만든 코드들은 수정과 추가가 용이함으로 전체적인 개발 속도는 단축된다고 볼 수 있다.

## 리펙터링의 조건

- 준비: 기능 추가
  기능을 추가할 때, 구조를 바꾸면 작업이 수월해 질만한 부분을 찾는다. 동작이 거의 일치하지만 함수 내부의 값이 미묘하게 다른 경우 중복코드가 생기게된다. 이런 경우 내부에서 사용되는 값을 매개변수로 변경하는 기법을 적용하면 중복 코드를 줄일 수 있다.

- 수정: 코드 이해
  코드를 수정하기 위해선 먼저 그 코드를 이해해야한다. 코드를 파악할 때 코드의 의도를 명확하게 하는 것이 이해를 돕는다.
  함수의 이름은 정확한지, 조건처리의 로직이 이상하지 않은 지등을 확인한다.

- 쓰레기줍기 리팩터링
  코드를 파악하는 중에 리팩터링이 필요한 부분이 보일 때, 하던 작업과 관계없는 코드를 수정하는 것도 애매하다. 이럴 땐 절충을 해서 간단한 것이라면 바로 고치고 시간이 걸린다 싶으면 주석으로 남기고 원래 작업을 마무리 한 후 처리한다.

### 리펙터링 방식

위에 나열된 리펙터링은 기회가 될 때 그때 그때 진행된다. 하지만 코드 리뷰 같이 정기적인 이벤트에 리팩터링을 활용하여 진행하는 것도 좋은 방법이다. 코드 리뷰의 피드백을 적용해 보면서 리펙터링을 진행하면 피드백을 더 구체적으로 적용할 수 있기 때문이다.

### 리펙터링을 하지 말아야 할 때

리펙터링이 좋긴 하지만 하면 안되는 상황도 존재한다. 코드가 지저분 해도 수정할 필요가 없거나, API등을 이용하는 코드는 그냥 둔다. 또는 새로 만드는게 낫다는 생각이 들면 안하는게 낫지만 이런 결정을 내리는건 쉽지 않다.

## 리팩터링의 고려사항

리팩토링 또한 만능이 아니기때문에 상황에 따라 행동해야한다.

### 새 기능 개발 속도 저하

리팩터링의 궁극적 목적은 개발 속도를 높여서 더 적은 노력으로 많은 가치를 창출 하는 것이다. 대대적인 리팩터링이 필요해 보이더라도 추가하는 기능이 작다면 스스로의 경험을 살려 리팩토링을 결정해야한다. 하지만 리팩터링을 하는 것이 코드를 수정하는 데에 도움이 되는 것이 분명하기에 리팩터링을 하는 것이 좋다. 리팩터링이 개발 속도를 저하시킨다는 이유는 위에서 말했듯이 전체적인 시간을 볼 때엔 속도를 단축시키는 것을 알 수 있다.

### 코드 소유권

리팩토링을 하다보면 다른 곳에서 사용중인 모듈이나 코드를 수정해야하는 상황이 온다. 코드 소유권을 가지고 있지 않는 상태에서는 부분적인 리팩터링밖에 할 수 없는 문제가 있다. 하지만 브랜치를 이용한 버전 관리를 통해 코드 소유권을 공유함으로 해결이 가능하다. 이때 브랜치의 통합 주기가 길면 길수록 마스터와 합치는 것이 힘들어 짐으로 마스터에 올리는 시간을 짧게 잡을 수록 좋다.

## 마무리

리팩터링에 대한 최종 결론은 리펙터링은 작업 시간을 늘리는 것이 아니라 오히려 단축시키고 경제적으로 이득이라는 점이다. 아직 까지는 저자가 리팩토링을 너무 찬양하는 것이 아닌가 라는 생각이 든다.
